#!/usr/bin/env node

/**
 * NubemSecurity CLI Launcher
 * Production-ready command-line interface
 */

import { fileURLToPath } from 'url';
import { dirname, join } from 'path';
import { spawn } from 'child_process';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Determine which mode to run
const args = process.argv.slice(2);
const isServerMode = args.includes('--server') || args.includes('-s');
const isWebMode = args.includes('--web') || args.includes('-w');

if (isServerMode) {
    // Run the production server
    console.log('🚀 Starting NubemSecurity Server...');
    const serverPath = join(__dirname, 'src', 'server.js');
    const server = spawn('node', [serverPath], {
        stdio: 'inherit',
        env: { ...process.env, NODE_ENV: 'production' }
    });
    
    server.on('error', (err) => {
        console.error('Failed to start server:', err);
        process.exit(1);
    });
} else if (isWebMode) {
    // Open web interface
    console.log('🌐 Opening NubemSecurity Web Interface...');
    const url = process.env.NUBEMSEC_URL || 'https://nubemsecurity-app-313818478262.us-central1.run.app';
    
    import('open').then(({ default: open }) => {
        open(url);
        console.log(`Web interface opened at: ${url}`);
    }).catch(() => {
        console.log(`Please open in your browser: ${url}`);
    });
} else {
    // Run the CLI interface
    const cliPath = join(__dirname, 'src', 'index.js');
    const cli = spawn('node', [cliPath, ...args], {
        stdio: 'inherit'
    });
    
    cli.on('error', (err) => {
        console.error('Failed to start CLI:', err);
        process.exit(1);
    });
    
    cli.on('exit', (code) => {
        process.exit(code || 0);
    });
}